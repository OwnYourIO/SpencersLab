# BitwardenIds moved to cluster secret annotation (metadata.annotations.services.gpu.bitwardenIds)
# The YAML block is parsed and each key-value pair becomes individual Helm parameters
# This allows charts to access values like: {{ index .Values "bitwardenIds" "coder-pg" }}
# Example cluster annotation:
# metadata.annotations.services.gpu.bitwardenIds: |
#   open-webui-sso-secret: "12345678-1234-1234-1234-123456789abc"
#   open-webui-secret: "87654321-4321-4321-4321-cba987654321"
#   open-webui-pg: "11111111-2222-3333-4444-555555555555"
#   coder-sso-secret: "aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee"
#   coder-pg: "ffffffff-gggg-hhhh-iiii-jjjjjjjjjjjj"
bitwardenIds:
  open-webui-sso-secret: OVERRIDE_VIA_CLUSTER_ANNOTATION
  open-webui-secret: OVERRIDE_VIA_CLUSTER_ANNOTATION
  open-webui-pg: OVERRIDE_VIA_CLUSTER_ANNOTATION
  coder-sso-secret: OVERRIDE_VIA_CLUSTER_ANNOTATION
  coder-pg: OVERRIDE_VIA_CLUSTER_ANNOTATION
  
  docling: OVERRIDE_VIA_CLUSTER_ANNOTATION
  neo4j: OVERRIDE_VIA_CLUSTER_ANNOTATION
  searxng: OVERRIDE_VIA_CLUSTER_ANNOTATION

seaweedfs-csi-driver:
  seaweedfsFiler: OVERRIDE_VIA_CUSTOM_VALUES
  mountService:
    enabled: true

domain: OVERRIDE_VIA_APPSET
clusterName: OVERRIDE_VIA_APPSET

# SeaweedFS configuration
seaweedfs:
  volumeCount: 5  # Number of seaweedfs volume servers to configure DNS rewrites for

# Chart definitions for appset-dev-charts.yaml
# Each chart can have: namespace, ServerSideApply, version, repository
charts:
  # Internal charts (no version/repository - uses charts/ directory)
  langflow:
    namespace: default
    ServerSideApply: "false"
  docling:
    namespace: default
    ServerSideApply: "false"
  drawio:
    namespace: default
    ServerSideApply: "false"
  searxng:
    namespace: default
    ServerSideApply: "false"
  archon:
    namespace: default
    ServerSideApply: "false"
  flowise:
    namespace: default
    ServerSideApply: "false"
  n8n:
    namespace: default
    ServerSideApply: "false"
  neo4j:
    namespace: default
    ServerSideApply: "false"
  qdrant:
    namespace: default
    ServerSideApply: "false"
  supabase:
    namespace: default
    ServerSideApply: "false"
  hivetools:
    namespace: default
    ServerSideApply: "true"
  # Disabled because they don't currently work and I like langflow better.
  #langfuse:
  #  namespace: default
  #  ServerSideApply: "false"
  #langgraph:
  #  namespace: default
  #  ServerSideApply: "false"
  
  # External charts (with version and repository)
  seaweedfs-csi-driver:
    version: 0.2.9
    repository: https://seaweedfs.github.io/seaweedfs-csi-driver/helm
    namespace: default
    ServerSideApply: "true"
  cloudnative-pg:
    version: 0.25.0
    repository: https://cloudnative-pg.github.io/charts
    namespace: default
    ServerSideApply: "true"
  ollama:
    version: 1.42.0
    repository: https://helm.otwld.com/
    namespace: default
    ServerSideApply: "false"
  open-webui:
    version: 10.2.1
    repository: https://helm.openwebui.com/
    namespace: default
    ServerSideApply: "false"
  amd-gpu:
    version: 0.21.0
    repository: https://rocm.github.io/k8s-device-plugin/
    namespace: default
    ServerSideApply: "true"
  coder:
    version: 2.25.1
    repository: https://helm.coder.com/v2
    namespace: default
    ServerSideApply: "false"
  external-secrets-bitwarden:
    version: 1.0.10 # renovate: datasource=helm registryUrl=https://ownyourio.github.io/SpencersLab/
    repository: https://ownyourio.github.io/SpencersLab/
    namespace: default
    ServerSideApply: "true"
  k8s-monitoring:
    #version: 1.0.10 # renovate: datasource=helm registryUrl=https://ownyourio.github.io/SpencersLab/
    #repository: https://ownyourio.github.io/SpencersLab/
    namespace: default
    ServerSideApply: "true"
  smtp-relay:
    #version: 1.0.13 # renovate: datasource=helm registryUrl=https://ownyourio.github.io/SpencersLab/
    #repository: https://ownyourio.github.io/SpencersLab/
    namespace: default
    ServerSideApply: "true"

ingress:
  dashboardProvider: homepage  # Set to "homepage" to enable Homepage annotations on ingress objects
  subdomains:
    ollama:
      serviceName: brains
      service: gpu-ollama
      port: 11434

    open-webui:
      serviceName: ai
      service: open-webui
      port: 80
      # Homepage integration example
      homepageEnabled: "true"
      homepageGroup: "AI Tools"
      homepageName: "Open WebUI"
      homepageDescription: "AI Chat Interface"
      homepageIcon: "open-webui.png"
      homepageWeight: "10"

    coder:
      serviceName: code
      service: coder
      port: 80
      # Homepage integration example
      homepageEnabled: "true"
      homepageGroup: "Development"
      homepageName: "Coder"
      homepageDescription: "Cloud Development Environment"
      homepageIcon: "coder.png"
      homepageWeight: "20"

    flowise:
      serviceName: flow
      service: gpu-flowise
      port: 3000
      # Homepage integration example
      homepageEnabled: "true"
      homepageGroup: "AI Tools"
      homepageName: "Flowise"
      homepageDescription: "Visual AI Flow Builder"
      homepageIcon: "flowise.png"
      homepageWeight: "30"

    langflow:
      serviceName: langflow
      service: gpu-langflow
      port: 7860

    n8n:
      serviceName: n8n
      service: gpu-n8n
      port: 5678

    qdrant:
      serviceName: qdrant
      service: gpu-qdrant
      port: 6333

    neo4j:
      serviceName: neo4j
      service: gpu-neo4j
      port: 7474

    searxng:
      serviceName: searxng
      service: gpu-searxng
      port: 8080

    drawio:
      serviceName: graph
      service: gpu-drawio
      port: 8080

    supabase:
      serviceName: supabase
      service: gpu-supabase
      port: 8000

    archon:
      serviceName: archon
      service: gpu-archon
      port: 3737

    cluster:
      clusterBase: true
      service: argocd-server
      port: 80
    traefik:
      clusterBase: true
      namespace: kube-system
      service: traefik
      port: 8080

ollama:
  gpu:
    # -- Enable GPU integration
    enabled: true
    
    # -- GPU type: 'nvidia' or 'amd'
    type: 'amd'
    
    # -- Specify the number of GPU to 1
    number: 1

  # -- List of models to pull at container startup
  #models:
  #  pull:
  #    - mistral
  #    - llama2
  resources:
    limits:
      cpu: 8000m
      memory: 28Gi
      amd.com/gpu: 1 # requesting a GPU
    requests:
      memory: 10Gi
      cpu: "1"
  image:
    repository: ollama/ollama
    tag: 0.15.1-rocm

  extraEnv:
    - name: OLLAMA_NUM_GPU
      value: "8"
    - name: OLLAMA_LOW_VRAM
      value: "true"  

  persistentVolume:
    enabled: true

open-webui:
  annotations:
    reloader.stakater.com/auto: "true"
  #replicaCount: 1
  resources:
    requests:
      cpu: 15m
      memory: 700Mi
    limits:
      cpu: 200m
      memory: 1Gi
  copyAppData:
    resources: {}
  ollama:
    enabled: false
  ollamaUrls: 
    - "http://gpu-ollama.default.svc.cluster.local:11434"
  pipelines:
    enabled: true
    persistence:
      existingClaim: open-webui-pipelines
  tika:
    enabled: true
    resources:
      requests:
        cpu: 15m
        memory: 650Mi
      limits:
        cpu: 100m
        memory: 800Mi
  websocket:
    enabled: true

  extraEnvFrom: 
    - secretRef:
        name: open-webui-secrets
  persistence:
    enabled: true
    existingClaim: open-webui
  podSecurityContext:
    supplementalGroups: 
      - 140
  containerSecurityContext:
    runAsUser: 1000
    runAsGroup: 150
    runAsNonRoot: true
    privileged: false
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities: 
      drop: 
        - "ALL"
    seccompProfile: 
      type: RuntimeDefault
coder: 
  coder:
    env:
      - name: CODER_OAUTH2_GITHUB_DEFAULT_PROVIDER_ENABLE
        value: "false"
      - name: CODER_OAUTH_GITHUB_ALLOW_SIGNUPS
        value: "false"
      - name: CODER_TELEMETRY
        value: "false"
      - name: CODER_PROMETHEUS_ENABLE
        value: 'true'

    envFrom:
      - secretRef:
          name: coder-secrets
    # This is needed because the Access URL is coming from envFrom
    envUseClusterAccessURL: false

    service:
      type: ClusterIP

langflow:
  app-template:
    persistence:
      knowledge:
        existingClaim: knowledge-shared

shared-storage:
  knowledge:
    pvc-name: knowledge-shared
    provider: seaweedfs
