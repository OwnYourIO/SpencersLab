{{- range $name, $config := .Values.proxy.subdomains }}
{{- if or $config.redirect $config.ssoRedirectPath }}
---
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: redirect-{{ $name }}
spec:
  plugin:
    traefik-plugin-redirect-on-status:
      redirectUri: https://{{ $name }}.{{ $.Values.domain }}{{ coalesce $config.path $config.ssoRedirectPath "/" }}
      redirectCode: {{ coalesce $config.redirectCode "307" }}
      status:
        {{ - if $config.redirect.status }}
        {{- range $config.redirect.status }}
        - {{ . | quote }}
        {{- end }}
        {{- else }}
        - "403"
        {{- end }}
{{- end }}
{{- end }}
