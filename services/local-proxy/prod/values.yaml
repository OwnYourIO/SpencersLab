# - IP Based filtering (Traefik?)
# - Middleware for Traefik
# - Maybe external routes/ingress/egress
seaweedfs-csi-driver:
  seaweedfsFiler: "seaweedfs-filer-0.infra.spencerslab.com:8880,seaweedfs-filer-1.infra.spencerslab.com:8881,seaweedfs-filer-2.infra.spencerslab.com:8882,seaweedfs-filer-3.infra.spencerslab.com:8883,seaweedfs-filer-4.infra.spencerslab.com:8884"

bitwardenIds:
  argocd-sso-secret: 6bc8ead2-faf6-4548-9831-b1a501646625
  autossh-secret: 449d6ac2-847d-4b2b-b0f2-b21d00003fc1

qbittorrent:
  global:
    nameOverride: "qbittorrent"
  controllers:
    main:
      initContainers:
        install-vuetorrent:
          image: 
            repository: busybox
            tag: 1.36.1@sha256:c3839dd800b9eb7603340509769c43e146a74c63dca3045a8e7dc8ee07e53966
          command:
            - "/bin/sh"
            - -c
          args:
            - |
              # renovate: github-release depName=WDaan/VueTorrent
              VUETORRENT_VERSION="v2.8.0"
              rm -rf /config/vuetorrent
              busybox wget -qO- "https://github.com/WDaan/VueTorrent/releases/download/$${VUETORRENT_VERSION}/vuetorrent.zip" | busybox unzip -d /config -
      containers:
        main:
          image:
            repository: ghcr.io/onedr0p/qbittorrent
            tag: 5.0.0

          env:
            TZ: America/Denver
            QBITTORRENT__PORT: &port 8080
            QBITTORRENT__BT_PORT: &port-bt 58462
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
            limits:
              memory: 8Gi
      pod:
        securityContext:
          runAsUser: 1000
          runAsGroup: 1000
          fsGroup: 1000
          fsGroupChangePolicy: "OnRootMismatch"
          supplementalGroups: [10000]

  service:
    main:
      controller: main
      ports:
        http:
          port: *port
    bittorent:
      enabled: true
      controller: main
      type: LoadBalancer
      ports:
        bittorrent:
          enabled: true
          port: *port-bt
          protocol: TCP
          targetPort: *port-bt
      externalTrafficPolicy: Local

  ingress:
    main:
      enabled: true
      hosts:
        - host: "qbittorrent.spencerslab.com"
          paths:
            - path: /
              pathType: Prefix
              service: 
                identifier: main
                port: http
      tls:
        - secretName: wildcard-cert
          hosts:
            - "qbittorrent.spencerslab.com"

  persistence:
    config:
      enabled: true
      existingClaim: qbittorrent
      globalMounts:
        - path: /config

    media:
      enabled: true
      existingClaim: media
      advancedMounts:
        main:
          main:
          - path: /media

autossh:
  global:
    nameOverride: "autossh"
  controllers:
    main:
      containers:
        main:
          image:
            repository: ghcr.io/camptocamp/autossh
            tag: master

          env:
            TZ: America/Denver
            SSH_REMOTE_USER: proxy
            SSH_KEY: 
              secretKeyRef:
                name: autossh
                key: private-key
            SSH_REMOTE_HOST: remote-proxy.spencerslab.com
            SSH_REMOTE_PORT: 2222
            SSH_TUNNEL_PORT: 443
            SSH_TARGET_HOST: traefik.kube-system
            SSH_TARGET_PORT: 443
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
            limits:
              memory: 8Gi
