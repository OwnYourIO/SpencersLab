mosquitto: 
  ingress:
    main:
      hosts:
        # Specify external host name
        - host: mqtt.spencerslab.com
          paths:
            - path: "/"
              pathType: Prefix
generic-device-plugin:
  app-template:
    controllers:
      main:
        containers:
          main:
            args:
              - --config 
              - /config/devices.yaml
            securityContext:
              readOnlyRootFilesystem: false
    persistence:
      device-plugins:
        enabled: true
        type: hostPath
        hostPath: /var/lib/kubelet/device-plugins
      dev:
        enabled: true
        type: hostPath
        hostPath: /dev
      config:
        enabled: true
        type: configMap
        name: home-generic-device-plugin-config

    configMaps:
      config:
        enabled: true
        data:
          devices.yaml: |-
            devices:
              - name: zigbee
                groups:
                  - paths:
                      - path: /dev/ttyUSB1
              - name: zwave
                groups:
                  - paths:
                      - path: /dev/ttyUSB0
bitwardenIds:
  zigbee2mqtt: 0164cfbc-dd85-43af-a4cc-b13f00108bde
zigbee2mqtt:
  bitwardenIds:
    zigbee2mqtt: 0164cfbc-dd85-43af-a4cc-b13f00108bde
  app-template:
    controllers:
      zigbee2mqtt:
        containers:
          main:
            env:
              TZ: America/Denver
              #ZIGBEE2MQTT_CONFIG_ADVANCED_LOG_LEVEL: info # debug
              #ZIGBEE2MQTT_CONFIG_ADVANCED_LOG_OUTPUT: '["console"]'
              ZIGBEE2MQTT_CONFIG_FRONTEND_URL: https://zigbee2mqtt.spencerslab.com
              ZIGBEE2MQTT_CONFIG_MQTT_SERVER: mqtt://home.spencerslab.com
              #ZIGBEE2MQTT_CONFIG_SERIAL_DISABLE_LED: false
              ZIGBEE2MQTT_CONFIG_MQTT_VERSION: "3.1.1"
              ZIGBEE2MQTT_CONFIG_SERIAL_BAUDRATE: 57600
              ZIGBEE2MQTT_CONFIG_SERIAL_PORT: /dev/ttyUSB1
              ZIGBEE2MQTT_CONFIG_SERIAL_ADAPTER: ezsp
              ZIGBEE2MQTT_CONFIG_PERMIT_JOIN: "true"
              #ZIGBEE2MQTT_CONFIG_ADVANCED_NETWORK_KEY: GENERATE
              # IDK do what the thing says: https://github.com/Koenkk/zigbee2mqtt/issues/19713
              ZIGBEE2MQTT_CONFIG_FRONTEND: "false"
            resources:
              limits:
                squat.ai/zigbee: 1
    ingress:
      zigbee2mqtt:
        annotations:
          hajimari.io/url: https://zigbee2mqtt.spencerslab.com
        hosts:
          - host: &host "zigbee2mqtt.spencerslab.com"
            paths: &paths
              - path: /
                service:
                  identifier: zigbee2mqtt
                  port: http
          - host: &customHost zigbee2mqtt.spencerslab.com
            paths: *paths
        tls:
          - hosts:
              - *host
              - *customHost
    persistence:
      config:
        existingClaim: zigbee2mqtt
