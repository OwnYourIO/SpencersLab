mosquitto: 
  ingress:
    main:
      hosts:
        # Specify external host name
        - host: mqtt.spencerslab.com
          paths:
            - path: "/"
              pathType: Prefix
generic-device-plugin:
  app-template:
    configMaps:
      config:
        enabled: true
        data:
          devices.yaml: |-
            devices:
              - name: zigbee
                groups:
                  - paths:
                      - path: /dev/ttyUSB1
              - name: zwave
                groups:
                  - paths:
                      - path: /dev/ttyUSB0
              - name: snd
                groups:
                  - paths:
                      - path: /dev/snd
zigbee2mqtt:
  bitwardenIds:
    zigbee2mqtt: 0164cfbc-dd85-43af-a4cc-b13f00108bde
  app-template:
    controllers:
      zigbee2mqtt:
        containers:
          main:
            env:
              TZ: America/Denver
              #DEBUG: zigbee-herdsman*
              #ZIGBEE2MQTT_CONFIG_ADVANCED_LOG_LEVEL: debug
              ZIGBEE2MQTT_CONFIG_FRONTEND_URL: https://zigbee2mqtt.spencerslab.com
              ZIGBEE2MQTT_CONFIG_MQTT_SERVER: mqtt://home.spencerslab.com
              ZIGBEE2MQTT_CONFIG_MQTT_VERSION: 4
              ZIGBEE2MQTT_CONFIG_SERIAL_BAUDRATE: 57600
              ZIGBEE2MQTT_CONFIG_SERIAL_PORT: /dev/ttyUSB1
              ZIGBEE2MQTT_CONFIG_SERIAL_ADAPTER: ezsp
    ingress:
      zigbee2mqtt:
        annotations:
          hajimari.io/url: https://zigbee2mqtt.spencerslab.com
        hosts:
          - host: &host "zigbee2mqtt.spencerslab.com"
            paths: &paths
              - path: /
                service:
                  identifier: zigbee2mqtt
                  port: http
        tls:
          - hosts:
              - *host
            secretName: wildcard-cert
music-assistant:
  app-template:
    controllers:
      music-assistant:
        containers:
          main:
            resources:
              requests:
                cpu: 1000m
                memory: 512Mi
              limits:
                memory: 1024Mi
            image:
                tag: 2.0.4
            env:
              LOG_LEVEL: debug
              TZ: America/Denver
      srs:
        containers:
          main:
            image:
              repository: ossrs/srs
              tag: v5.0.210
            env:
              TZ: America/Denver

    pod: 
      hostNetwork: true
    service:
      music-assistant:
        primary: true
      snapcast:
        type: LoadBalancer
        controller: music-assistant
        externalTrafficPolicy: Local
        ports:
          stream:
            port: 1704
          control:
            port: 1705
      lms:
        type: LoadBalancer
        controller: music-assistant
        externalTrafficPolicy: Local
        ports:
          http3:
            port: 9000
          cli:
            port: 9090
          stream:
            port: 1780
          another:
            port: 8095
          another2:
            port: 8097
          another3:
            port: 8098
          slimproto-tcp:
            port: 3483
            protocol: TCP
          slimproto-udp:
            port: 3483
            protocol: UDP
    
      srs:
        controller: srs
        ports:
          http:
            port: 8080
          api:
            port: 1985
            protocol: TCP
      rtmp:
        controller: srs
        type: LoadBalancer
        externalTrafficPolicy: Local
        ports:
          http:
            port: 8080
          rtmp:
            enabled: true
            port: 1935
            protocol: TCP
            
    configMaps:
      srs-config:
        labels: {}
        annotations: {}
        data:
          docker.conf: |-
            listen              1935;
            max_connections     1000;
            http_api {
                enabled         on;
                listen          1985;
            }
            http_server {
                enabled         on;
                listen          8080;
            }
            vhost __defaultVhost__ {
                tcp_nodelay     on;
                min_latency     on;

                play {
                    gop_cache       off;
                    queue_length    10;
                    mw_latency      100;
                }

                publish {
                    mr off;
                }
            }

    persistence:
      tmp:
        enabled: true
        type: emptyDir
      config:
        existingClaim: owncast-config
        globalMounts:
          - path: /app/data
      srs-config:
        type: configMap
        name: "{{ .Release.Name }}-music-assistant-srs-config"
        globalMounts:
          - path: /usr/local/srs/conf
    #controllers:
    #  music-assistant:
    #    containers:
    #      main: 
    #        env: 
    #          LOG_LEVEL: debug

    ingress:
      music-assistant:
        annotations:
          hajimari.io/url: https://music-assistant.spencerslab.com
        hosts:
          - host: &host "music-assistant.spencerslab.com"
            paths: &paths
              - path: /
                service:
                  identifier: music-assistant
                  port: http
        tls:
          - hosts:
              - *host
            secretName: wildcard-cert
      srs:
        hosts:
          - host: &host "stream.spencerslab.com"
            paths:
              - path: /
                service:
                  identifier: srs
                  port: http
              - path: /api/
                service:
                  identifier: srs
                  port: api
        tls:
          - hosts:
              - *host

espresense:
  bitwardenIds:
    espresense: 1130d75e-e16c-428b-bf99-b15b0010e993
  app-template:
    ingress:
      espresense:
        annotations:
          hajimari.io/url: https://espresense.spencerslab.com
        hosts:
          - host: &host "espresense.spencerslab.com"
            paths: &paths
              - path: /
                service:
                  identifier: espresense
                  port: http
        tls:
          - hosts:
              - *host
            secretName: wildcard-cert

ledfx:
  app-template:
    controllers:
      ledfx:
        containers:
          main:
            env:
              SQUEEZE: 1
    ingress:
      ledfx:
        annotations:
          hajimari.io/url: https://ledfx.spencerslab.com
        hosts:
          - host: &host "ledfx.spencerslab.com"
            paths: &paths
              - path: /
                service:
                  identifier: ledfx
                  port: http
        tls:
          - hosts:
              - *host
            secretName: wildcard-cert
    persistence:
      config:
        existingClaim: ledfx
        advancedMounts:
          ledfx:
            main:
              - path: /app/ledfx-config/


hyperion:
  app-template:
    controllers:
      hyperion:
        containers:
          main:
            env:
              TZ: America/Denver
              PUID: 911
              PGID: 1000
            securityContext:
              allowPrivilegeEscalation: false
              capabilities:
                drop: 
                  - ALL
        pod:
          securityContext:
            #runAsNonRoot: false
            #runAsUser: 911
            fsGroup: 911
            fsGroupChangePolicy: OnRootMismatch

    ingress:
      hyperion:
        annotations:
          hajimari.io/url: https://hyperhdr.spencerslab.com
        hosts:
          - host: &host "hyperhdr.spencerslab.com"
            paths:
              - path: /
                service:
                  identifier: hyperion
                  port: http
        tls:
          - hosts:
              - *host
